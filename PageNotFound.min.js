/* ============================================================
   Akshat Network Hub â€“ PageNotFound Engine (Ultra Edition)
   File     : PageNotFound.js
   Purpose  : Centralized error detection & routing system
   Author   : Akshat Network Hub
   ============================================================ */

(function () {
  "use strict";

  /* ------------------------------------------------------------
     SCHOOL CONFIGURATION (Global Rules)
     ------------------------------------------------------------ */
  const AKSHAT_SCHOOL = {
    waitTime: 15000,            // SPA / PDF safe delay
    minTextLength: 120,
    maxWaitForNetwork: 8000,

    routes: {
      NOT_FOUND: "/LearningClub-Key-of-Success-Learning-Point/Error/404.htm",
      EMPTY: "/LearningClub-Key-of-Success-Learning-Point/Error/empty.htm",
      IFRAME: "/LearningClub-Key-of-Success-Learning-Point/Error/iframe.htm",
      BLOCKED: "/LearningClub-Key-of-Success-Learning-Point/Error/blocked.htm",
      OFFLINE: "/LearningClub-Key-of-Success-Learning-Point/Error/no-internet.htm",
      TIMEOUT: "/LearningClub-Key-of-Success-Learning-Point/Error/timeout.htm",
      PERMISSION: "/LearningClub-Key-of-Success-Learning-Point/Error/permission.htm",
      CORS: "/LearningClub-Key-of-Success-Learning-Point/Error/cors.htm",
      CSP: "/LearningClub-Key-of-Success-Learning-Point/Error/csp.htm",
      DNS: "/LearningClub-Key-of-Success-Learning-Point/Error/dns.htm",
      SERVER: "/LearningClub-Key-of-Success-Learning-Point/Error/server.htm",
      MAINTENANCE: "/LearningClub-Key-of-Success-Learning-Point/Error/maintenance.htm"
    }
  };

  /* ------------------------------------------------------------
     FAMILY ROUTER (Redirection Brain)
     ------------------------------------------------------------ */
  function prasadParivaarRedirect(type, reason) {
    const from = encodeURIComponent(
      window.location.pathname + window.location.search
    );

    const why = encodeURIComponent(reason || type);

    const target =
      AKSHAT_SCHOOL.routes[type] ||
      AKSHAT_SCHOOL.routes.NOT_FOUND;

    window.location.replace(`${target}?from=${from}&reason=${why}`);
  }

  function rakshaTry(fn, fallback) {
    try {
      return fn();
    } catch (e) {
      return fallback;
    }
  }

  /* ------------------------------------------------------------
     SUBJECT CHECKS (Logical Validators)
     ------------------------------------------------------------ */

  // ðŸ“ Mathematics â€“ Content existence
  function mathsHasMeaning() {
    const body = document.body;
    if (!body) return false;

    const text = body.innerText.replace(/\s+/g, " ").trim();

    const markers = [
      document.querySelector("canvas"),
      document.querySelector("section"),
      document.querySelector("article"),
      document.querySelector("main"),
      document.querySelector("[data-page]"),
      document.querySelector("img"),
      document.querySelector("video"),
      document.querySelector("svg")
    ];

    return (
      text.length >= AKSHAT_SCHOOL.minTextLength ||
      markers.some(Boolean)
    );
  }

  // ðŸ”¬ Physics â€“ iframe / embed detection
  function physicsIsEmbedded() {
    return rakshaTry(() => window.self !== window.top, true);
  }

  // ðŸ§ª Chemistry â€“ blank DOM
  function chemistryIsEmpty() {
    return (
      document.body &&
      document.body.children.length === 0
    );
  }

  // ðŸ’» Computer Science â€“ title signals
  function computerTitleInvalid() {
    const t = (document.title || "").toLowerCase();
    return (
      t.includes("404") ||
      t.includes("not found") ||
      t.includes("error")
    );
  }

  // ðŸ› Civics â€“ visibility / blocked
  function civicsIsHidden() {
    return (
      document.hidden === true ||
      document.visibilityState === "hidden"
    );
  }

  // ðŸŒ Geography â€“ internet connectivity
  function geographyOffline() {
    return navigator.onLine === false;
  }

  // â± History â€“ timeout / long load
  function historyTimedOut(startTime) {
    return Date.now() - startTime > AKSHAT_SCHOOL.maxWaitForNetwork;
  }

  // ðŸ§¾ Economics â€“ permission / access
  function economicsPermissionDenied() {
    return rakshaTry(() => {
      return document.body?.innerText
        .toLowerCase()
        .includes("permission denied");
    }, false);
  }

  // âš– Law â€“ CSP / CORS
  function lawCSPBlocked() {
    return rakshaTry(() => {
      return (
        document.querySelector(
          "meta[http-equiv='Content-Security-Policy']"
        ) !== null
      );
    }, false);
  }

  function lawCORSBlocked() {
    return rakshaTry(() => {
      return window.location.origin !== document.referrer.origin;
    }, false);
  }

  /* ------------------------------------------------------------
     COLLEGE CONTROLLER (Decision Engine)
     ------------------------------------------------------------ */
  const examStartTime = Date.now();

  function collegeFinalExam() {

    // 1. OFFLINE
    if (geographyOffline()) {
      prasadParivaarRedirect("OFFLINE", "no_internet");
      return;
    }

    // 2. IFRAME BLOCK
    if (physicsIsEmbedded()) {
      prasadParivaarRedirect("IFRAME", "embedded_context");
      return;
    }

    // 3. BLANK PAGE
    if (chemistryIsEmpty()) {
      prasadParivaarRedirect("EMPTY", "blank_dom");
      return;
    }

    // 4. VISIBILITY BLOCK
    if (civicsIsHidden()) {
      prasadParivaarRedirect("BLOCKED", "tab_hidden");
      return;
    }

    // 5. TIMEOUT
    if (historyTimedOut(examStartTime)) {
      prasadParivaarRedirect("TIMEOUT", "load_timeout");
      return;
    }

    // 6. PERMISSION
    if (economicsPermissionDenied()) {
      prasadParivaarRedirect("PERMISSION", "access_denied");
      return;
    }

    // 7. CSP
    if (lawCSPBlocked()) {
      prasadParivaarRedirect("CSP", "content_security_policy");
      return;
    }

    // 8. CORS
    if (lawCORSBlocked()) {
      prasadParivaarRedirect("CORS", "cross_origin");
      return;
    }

    // 9. TITLE SIGNAL
    if (computerTitleInvalid()) {
      prasadParivaarRedirect("NOT_FOUND", "title_signal");
      return;
    }

    // 10. NO CONTENT (PRIMARY)
    if (!mathsHasMeaning()) {
      prasadParivaarRedirect("EMPTY", "no_meaningful_content");
      return;
    }

    // 11. PASS â€“ PAGE IS VALID
    // Silent success
  }

  /* ------------------------------------------------------------
     FINAL TIMER (Exam Bell)
     ------------------------------------------------------------ */
  setTimeout(collegeFinalExam, AKSHAT_SCHOOL.waitTime);

})();